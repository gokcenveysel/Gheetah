<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gheetah Java-Cucumber Integration Guide</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 20px;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        code {
            font-family: Consolas, monospace;
        }
        ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        li {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>Gheetah Java-Cucumber Integration Guide</h1>
    <p>Welcome to the Gheetah Test Orchestration Platform! This guide explains how to set up and run Java-Cucumber projects with Gheetah, supporting both TestNG and JUnit 4 frameworks, using the Formy website for testing.</p>

    <h2>Overview</h2>
    <p>Gheetah automates Cucumber test execution by dynamically configuring Java projects. It supports:</p>
    <ul>
        <li>TestNG and JUnit 4 frameworks.</li>
        <li>Dynamic TAG generation for scenarios in <code>.feature</code> files.</li>
        <li>Automatic project configuration via <code>JavaProjectConfigurator.cs</code>.</li>
        <li>Selenium-based browser automation with Formy.</li>
        <li>Custom XML report generation via <code>CustomCucumberFormatter</code>, even for failed tests.</li>
        <li>Automatic cleanup of project directories and zip files.</li>
    </ul>

    <h2>Project Structure</h2>
    <p>Your Java-Cucumber project should follow this structure for both TestNG and JUnit 4 projects:</p>
    <pre><code>
java-cucumber-[testng|junit4]-formy/
├── pom.xml (or build.gradle)
├── src/
│   ├── test/
│   │   ├── java/
│   │   │   ├── runner/
│   │   │   │   └── CucumberRunner.java
│   │   │   ├── steps/
│   │   │   │   ├── FormSteps.java
│   │   │   │   └── CustomCucumberFormatter.java
│   │   │   ├── utils/
│   │   │   │   └── TestBase.java
│   │   │   └── pages/
│   │   │       └── FormPage.java
│   │   └── resources/
│   │       └── features/
│   │           └── form.feature
└── testng.xml (for TestNG only)
    </code></pre>

    <h2>Setting Up Your Project</h2>

    <h3>TestNG Project</h3>
    <ol>
        <li>
            <p>Create a Maven project with the following <code>pom.xml</code>:</p>
            <pre><code>&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;com.example&lt;/groupId&gt;
    &lt;artifactId&gt;java-cucumber-testng-formy&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

    &lt;properties&gt;
        &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.cucumber&lt;/groupId&gt;
            &lt;artifactId&gt;cucumber-java&lt;/artifactId&gt;
            &lt;version&gt;7.20.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.cucumber&lt;/groupId&gt;
            &lt;artifactId&gt;cucumber-testng&lt;/artifactId&gt;
            &lt;version&gt;7.20.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.cucumber&lt;/groupId&gt;
            &lt;artifactId&gt;cucumber-picocontainer&lt;/artifactId&gt;
            &lt;version&gt;7.20.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.testng&lt;/groupId&gt;
            &lt;artifactId&gt;testng&lt;/artifactId&gt;
            &lt;version&gt;7.10.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.hamcrest&lt;/groupId&gt;
            &lt;artifactId&gt;hamcrest&lt;/artifactId&gt;
            &lt;version&gt;2.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
            &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt;
            &lt;version&gt;2.0.16&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.seleniumhq.selenium&lt;/groupId&gt;
            &lt;artifactId&gt;selenium-java&lt;/artifactId&gt;
            &lt;version&gt;4.34.0&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.2.5&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;suiteXmlFiles&gt;
                        &lt;suiteXmlFile&gt;testng.xml&lt;/suiteXmlFile&gt;
                    &lt;/suiteXmlFiles&gt;
                    &lt;systemPropertyVariables&gt;
                        &lt;cucumber.filter.tags&gt;${cucumber.filter.tags}&lt;/cucumber.filter.tags&gt;
                    &lt;/systemPropertyVariables&gt;
                    &lt;reportsDirectory&gt;TestResults&lt;/reportsDirectory&gt;
                    &lt;properties&gt;
                        &lt;property&gt;
                            &lt;name&gt;listener&lt;/name&gt;
                            &lt;value&gt;org.testng.reporters.XMLReporter&lt;/value&gt;
                        &lt;/property&gt;
                    &lt;/properties&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.13.0&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;source&gt;17&lt;/source&gt;
                    &lt;target&gt;17&lt;/target&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
            </code></pre>
        </li>
        <li>
            <p>Add a TestNG runner class (<code>CucumberRunner.java</code>):</p>
            <pre><code>package runner;

import io.cucumber.testng.AbstractTestNGCucumberTests;
import io.cucumber.testng.CucumberOptions;

@CucumberOptions(
    features = "src/test/resources/features",
    glue = {"steps"},
    plugin = {"pretty", "steps.CustomCucumberFormatter"},
    monochrome = true
)
public class CucumberRunner extends AbstractTestNGCucumberTests {
}
            </code></pre>
        </li>
        <li>
            <p>Create a <code>testng.xml</code>:</p>
            <pre><code>&lt;!DOCTYPE suite SYSTEM "https://testng.org/testng-1.0.dtd"&gt;
&lt;suite name="CucumberTestSuite"&gt;
    &lt;listeners&gt;
        &lt;listener class-name="org.testng.reporters.XMLReporter"/&gt;
    &lt;/listeners&gt;
    &lt;test name="CucumberTests"&gt;
        &lt;classes&gt;
            &lt;class name="runner.CucumberRunner"/&gt;
        &lt;/classes&gt;
    &lt;/test&gt;
&lt;/suite&gt;
            </code></pre>
        </li>
        <li>Add your step definitions, page objects, and feature files as shown in the reference project.</li>
    </ol>

    <h3>JUnit 4 Project</h3>
    <ol>
        <li>
            <p>Create a Maven project with the following <code>pom.xml</code>:</p>
            <pre><code>&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;com.example&lt;/groupId&gt;
    &lt;artifactId&gt;java-cucumber-junit4-formy&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

    &lt;properties&gt;
        &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.cucumber&lt;/groupId&gt;
            &lt;artifactId&gt;cucumber-java&lt;/artifactId&gt;
            &lt;version&gt;7.20.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.cucumber&lt;/groupId&gt;
            &lt;artifactId&gt;cucumber-junit&lt;/artifactId&gt;
            &lt;version&gt;7.20.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.cucumber&lt;/groupId&gt;
            &lt;artifactId&gt;cucumber-picocontainer&lt;/artifactId&gt;
            &lt;version&gt;7.20.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
            &lt;version&gt;4.13.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.hamcrest&lt;/groupId&gt;
            &lt;artifactId&gt;hamcrest&lt;/artifactId&gt;
            &lt;version&gt;2.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
            &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt;
            &lt;version&gt;2.0.16&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.seleniumhq.selenium&lt;/groupId&gt;
            &lt;artifactId&gt;selenium-java&lt;/artifactId&gt;
            &lt;version&gt;4.34.0&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.2.5&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;systemPropertyVariables&gt;
                        &lt;cucumber.filter.tags&gt;${cucumber.filter.tags}&lt;/cucumber.filter.tags&gt;
                    &lt;/systemPropertyVariables&gt;
                    &lt;reportsDirectory&gt;TestResults&lt;/reportsDirectory&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.13.0&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;source&gt;17&lt;/source&gt;
                    &lt;target&gt;17&lt;/target&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
            </code></pre>
        </li>
        <li>
            <p>Add a JUnit runner class (<code>CucumberRunner.java</code>):</p>
            <pre><code>package runner;

import io.cucumber.junit.Cucumber;
import io.cucumber.junit.CucumberOptions;
import org.junit.runner.RunWith;

@RunWith(Cucumber.class)
@CucumberOptions(
    features = "src/test/resources/features",
    glue = {"steps"},
    plugin = {"pretty", "steps.CustomCucumberFormatter"},
    monochrome = true
)
public class CucumberRunner {
}
            </code></pre>
        </li>
        <li>Add your step definitions, page objects, and feature files as shown in the reference project.</li>
    </ol>

    <h3>Gradle Project (Optional)</h3>
    <p>If you prefer Gradle, use the following <code>build.gradle</code>:</p>
    <pre><code>plugins {
    id 'java'
}

group 'com.example'
version '1.0-SNAPSHOT'

repositories {
    mavenCentral()
}

dependencies {
    implementation 'io.cucumber:cucumber-java:7.20.1'
    testImplementation 'io.cucumber:cucumber-testng:7.20.1' // or 'cucumber-junit:7.20.1' for JUnit
    testImplementation 'io.cucumber:cucumber-picocontainer:7.20.1'
    testImplementation 'org.testng:testng:7.10.2' // or 'junit:junit:4.13.2' for JUnit
    testImplementation 'org.hamcrest:hamcrest:2.2'
    implementation 'org.slf4j:slf4j-simple:2.0.16'
    implementation 'org.seleniumhq.selenium:selenium-java:4.34.0'
}

test {
    systemProperty 'cucumber.filter.tags', System.getProperty('cucumber.filter.tags')
    testLogging {
        showStandardStreams = true
    }
}
    </code></pre>
    <p><strong>Note:</strong> Replace <code>cucumber-testng</code> and <code>testng</code> with <code>cucumber-junit</code> and <code>junit</code> for JUnit projects.</p>

    <h2>Gheetah Agent Implementation</h2>
    <p>The Gheetah Agent uses <code>JavaScenarioExecutor.cs</code> to execute tests, generate XML reports, and clean up resources. Key components include:</p>

    <h3>CustomCucumberFormatter.java</h3>
    <p>This custom Cucumber plugin generates XML reports in the <code>TestResults</code> directory, even for failed tests. It captures scenario steps and outcomes (passed, failed, or skipped).</p>
    <pre><code>package steps;

import io.cucumber.plugin.ConcurrentEventListener;
import io.cucumber.plugin.event.*;
import java.io.*;
import java.nio.file.*;
import java.text.SimpleDateFormat;
import java.util.*;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class CustomCucumberFormatter implements ConcurrentEventListener {
    private static final Logger logger = LoggerFactory.getLogger(CustomCucumberFormatter.class);
    private final List&lt;String&gt; stdOutMessages = new ArrayList&lt;&gt;();
    private String outputFilePath;
    private String scenarioTag;

    public CustomCucumberFormatter() {
        logger.info("Initializing CustomCucumberFormatter");
    }

    @Override
    public void setEventPublisher(EventPublisher publisher) {
        logger.info("Setting event publisher for CustomCucumberFormatter");
        publisher.registerHandlerFor(TestCaseStarted.class, this::handleTestCaseStarted);
        publisher.registerHandlerFor(TestStepStarted.class, this::handleTestStepStarted);
        publisher.registerHandlerFor(TestStepFinished.class, this::handleTestStepFinished);
        publisher.registerHandlerFor(TestCaseFinished.class, this::handleTestCaseFinished);
    }

    private void handleTestCaseStarted(TestCaseStarted event) {
        TestCase testCase = event.getTestCase();
        scenarioTag = testCase.getTags().stream()
            .filter(tag -> tag.startsWith("@"))
            .findFirst()
            .map(tag -> tag.substring(1))
            .orElse("UnknownTag");
        String timestamp = new SimpleDateFormat("yyyyMMdd_HHmmss").format(new Date());
        outputFilePath = String.format("TestResults/%s_%s_test_results.xml", scenarioTag, timestamp);
        stdOutMessages.clear();
        stdOutMessages.add("Scenario: " + testCase.getName());
        logger.info("Test case started: {}, Output file: {}", testCase.getName(), outputFilePath);
    }

    private void handleTestStepStarted(TestStepStarted event) {
        if (event.getTestStep() instanceof PickleStepTestStep step) {
            stdOutMessages.add(step.getStep().getKeyword() + step.getStep().getText());
            logger.info("Test step started: {}", step.getStep().getText());
        }
    }

    private void handleTestStepFinished(TestStepFinished event) {
        if (event.getTestStep() instanceof PickleStepTestStep step) {
            Status status = event.getResult().getStatus();
            String statusMessage = switch (status) {
                case PASSED -> "-> done: " + step.getStep().getText() + " (" + event.getResult().getDuration().toMillis() / 1000.0 + "s)";
                case FAILED -> "-> error: " + event.getResult().getError().getMessage();
                default -> "-> " + status.name().toLowerCase() + ": " + step.getStep().getText();
            };
            stdOutMessages.add(statusMessage);
            logger.info("Test step finished: {}", statusMessage);
        }
    }

    private void handleTestCaseFinished(TestCaseFinished event) {
        logger.info("Test case finished, writing XML report to: {}", outputFilePath);
        try {
            Files.createDirectories(Paths.get("TestResults"));
            logger.info("TestResults directory created or exists");
            try (PrintWriter writer = new PrintWriter(new FileWriter(outputFilePath))) {
                writer.println("&lt;Results xmlns=\"http://microsoft.com/schemas/VisualStudio/TeamTest/2010\"&gt;");
                writer.println("    &lt;UnitTestResult&gt;");
                writer.println("        &lt;Output&gt;");
                writer.println("            &lt;StdOut&gt;" + String.join("\n", stdOutMessages) + "&lt;/StdOut&gt;");
                writer.println("        &lt;/Output&gt;");
                writer.println("    &lt;/UnitTestResult&gt;");
                writer.println("&lt;/Results&gt;");
                logger.info("XML report written successfully to: {}", outputFilePath);
            }
        } catch (IOException e) {
            logger.error("Failed to write XML report: {}", e.getMessage(), e);
            throw new RuntimeException("Failed to write XML report: " + e.getMessage(), e);
        }
    }
}
    </code></pre>
    <p><strong>Key Features:</strong></p>
    <ul>
        <li>Generates XML reports in <code>TestResults/&lt;scenarioTag&gt;_&lt;timestamp&gt;_test_results.xml</code>.</li>
        <li>Logs scenario steps, including failures (e.g., <code>-> error: Expected condition failed...</code>).</li>
        <li>Ensures reports are generated even if tests fail.</li>
    </ul>

    <h3>JavaScenarioExecutor.cs</h3>
    <p>The Gheetah Agent uses <code>JavaScenarioExecutor.cs</code> to:</p>
    <ul>
        <li>Execute Maven or Gradle commands with dynamic tags (e.g., <code>mvn test -Dcucumber.filter.tags="@YourScenarioTag"</code>).</li>
        <li>Search for XML reports in <code>TestResults</code> and send them via <code>AgentService.SendResultAsync</code>.</li>
        <li>Clean up project directories and zip files, even for failed tests.</li>
        <li>Handle timeouts and errors during execution or report sending.</li>
    </ul>
    <p><strong>Note:</strong> The agent ensures cleanup occurs regardless of test outcome, but stops execution only for critical agent errors (e.g., file access issues).</p>

    <h2>Dynamic TAG Generation</h2>
    <p>Gheetah automatically adds unique TAGs to each scenario in <code>.feature</code> files (e.g., <code>@SubmitTheFormyFormWithValidData_1234567890</code>). These TAGs are used to execute specific scenarios via Maven:</p>
    <pre><code>mvn test -Dcucumber.filter.tags="@SubmitTheFormyFormWithValidData_1234567890"
    </code></pre>
    <p>Ensure your feature files are in <code>src/test/resources/features/</code>.</p>

    <h2>Running Tests with Gheetah</h2>
    <ol>
        <li><strong>Clone or Create a Project:</strong> Use one of our reference projects or set up your own using the Formy website (<a href="https://formy-project.herokuapp.com/form">https://formy-project.herokuapp.com/form</a>).</li>
        <li><strong>Upload to Gheetah:</strong> Upload your project directory to the Gheetah platform.</li>
        <li><strong>Automatic Configuration:</strong> Gheetah will:
            <ul>
                <li>Detect project type (TestNG or JUnit 4) based on <code>pom.xml</code> or runner class.</li>
                <li>Update <code>pom.xml</code> with required dependencies.</li>
                <li>Add <code>testng.xml</code> for TestNG projects.</li>
                <li>Add dynamic TAGs to <code>.feature</code> files.</li>
                <li>Inject <code>CustomCucumberFormatter</code> for XML report generation.</li>
            </ul>
        </li>
        <li><strong>Execute Tests:</strong> Select a scenario TAG from the Gheetah UI and run the test. Gheetah executes:
            <pre><code>cd /path/to/your/project
mvn test -Dcucumber.filter.tags="@YourScenarioTag"
            </code></pre>
        </li>
        <li><strong>View Reports:</strong> XML reports are generated in <code>TestResults</code> and sent to the Gheetah platform. Check <code>target/surefire-reports/</code> for detailed logs.</li>
    </ol>

    <h2>Reference Projects</h2>
    <p>Download our reference projects for the Formy website:</p>
    <ul>
        <li><a href="#">TestNG Example (java-cucumber-testng-formy)</a></li>
        <li><a href="#">JUnit 4 Example (java-cucumber-junit4-formy)</a></li>
    </ul>

    <h2>Troubleshooting</h2>
    <ul>
        <li><strong>TestNG.xml created for JUnit 4:</strong> Ensure <code>pom.xml</code> includes <code>cucumber-junit</code> and the runner class has <code>@RunWith(Cucumber.class)</code>.</li>
        <li><strong>Incorrect dependencies:</strong> Verify <code>pom.xml</code> has <code>cucumber-junit</code> and <code>junit</code> for JUnit 4, or <code>cucumber-testng</code> and <code>testng</code> for TestNG. Clean Maven cache with <code>mvn dependency:purge-local-repository</code>.</li>
        <li><strong>Constructor errors:</strong> Ensure <code>cucumber-picocontainer</code> is in <code>pom.xml</code> for dependency injection.</li>
        <li><strong>SLF4J warnings:</strong> Add <code>slf4j-simple</code> to <code>pom.xml</code>.</li>
        <li><strong>Tests not running:</strong> Verify <code>pom.xml</code> dependencies and <code>cucumber.filter.tags</code>. Use <code>org.hamcrest.MatcherAssert</code> in JUnit step definitions.</li>
        <li><strong>Test failures not generating XML:</strong> Ensure <code>CustomCucumberFormatter</code> is in <code>src/test/java/steps/</code> and included in <code>CucumberOptions</code>. Check logs for <code>XML report written successfully</code>.</li>
        <li><strong>CDP warnings:</strong> Update <code>selenium-java</code> to 4.34.0 to support Chrome 138. Verify Chrome version (<code>chrome://version</code>).</li>
        <li><strong>Connection errors:</strong> Ensure Formy is accessible (<a href="https://formy-project.herokuapp.com/form">https://formy-project.herokuapp.com/form</a>) and no network restrictions apply.</li>
        <li><strong>Process hangs:</strong> Check <code>C:\Users\User\AppData\Local\Temp\Gheetah_Agent.log</code> for timeouts (e.g., <code>Timeout sending output/result</code>) or cleanup errors.</li>
        <li><strong>Check logs:</strong> Review <code>target/surefire-reports/</code> and <code>Gheetah_Agent.log</code> for detailed errors.</li>
    </ul>

    <h2>Contact</h2>
    <p>For support, contact us at <a href="mailto:support@gheetah.com">support@gheetah.com</a>.</p>
</body>
</html>