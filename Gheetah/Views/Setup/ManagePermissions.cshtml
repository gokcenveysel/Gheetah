@using Gheetah.Models.ViewModels.Setup
@using Microsoft.AspNetCore.Mvc.TagHelpers
@model List<Gheetah.Models.ViewModels.Setup.GroupPermissionVm>
@{
    var permissions = ViewBag.Permissions as List<PermissionVm>;
    var hasSaved = (bool)(ViewBag.HasSaved ?? false);
}

<div class="page-body">
    <div class="container-xl">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-shield-lock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M12 3a12 12 0 0 0 8.5 3a12 12 0 0 1 -8.5 15a12 12 0 0 1 -8.5 -15a12 12 0 0 0 8.5 -3" />
                        <path d="M12 11m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
                        <path d="M12 12l0 2.5" />
                    </svg>
                    Assign Permissions to Groups
                </h3>
            </div>
            <form method="post" asp-action="SavePermissions">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered table-vcenter">
                            <thead>
                                <tr>
                                    <th>Group</th>
                                    @foreach (var perm in permissions)
                                    {
                                        <th class="text-center">@perm.Name</th>
                                    }
                                </tr>
                            </thead>
                            <tbody>
                                @for (int i = 0; i < Model.Count; i++)
                                {
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <span class="avatar avatar-xs me-2">@Model[i].GroupName[0]</span>
                                                @Model[i].GroupName
                                            </div>
                                            <input type="hidden" name="model[@i].GroupId" value="@Model[i].GroupId" />
                                            <input type="hidden" name="model[@i].GroupName" value="@Model[i].GroupName" />
                                        </td>
                                        @foreach (var perm in permissions)
                                        {
                                            <td class="text-center">
                                                <label class="form-check form-check-single form-switch">
                                                    <input class="form-check-input"
                                                           type="checkbox"
                                                           name="model[@i].SelectedPermissionIds"
                                                           value="@perm.Id"
                                                    @(Model[i].SelectedPermissionIds.Contains(perm.Id) ? "checked" : "")>
                                                </label>
                                            </td>
                                        }
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer d-flex justify-content-between">
                    <button type="submit" name="action" value="save" class="btn btn-secondary">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-device-floppy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                            <path d="M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2" />
                            <path d="M12 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
                            <path d="M14 4l0 4l-6 0l0 -4" />
                        </svg>
                        Save Permissions
                    </button>
                    @if (hasSaved)
                    {
                        <button type="submit" name="action" value="complete" class="btn btn-primary">
                            Complete Setup
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                <path d="M5 12l5 5l10 -10" />
                            </svg>
                        </button>
                    }
                </div>
            </form>
        </div>
    </div>
</div>